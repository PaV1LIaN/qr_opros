<?php global $USER; if ($USER->IsAdmin()): ?>

<!-- Подключаем Select2 (один раз, если ещё не подключено) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<form method="post">
    <?=bitrix_sessid_post()?>

    <input type="text" name="SITE_TITLE" placeholder="Название сайта (русское)" required style="min-width:320px;"><br><br>
    <input type="text" name="SITE_CODE" placeholder="Код сайта (латиница, если пусто — сгенерируется)" style="min-width:320px;"><br><br>

    <input type="text" name="ROLE_NAME" placeholder="Название роли (например: Редакторы сайта)" required style="min-width:320px;"><br><br>

    <h3>Добавить пользователей в роль:</h3>
    <select name="ROLE_USERS[]" multiple id="create-site-users" style="width:320px;">
        <?php
        $rsUsers = \CUser::GetList($by="id", $order="asc", ["ACTIVE"=>"Y"]);
        while ($user = $rsUsers->Fetch()):
            $label = trim($user["NAME"]." ".$user["LAST_NAME"]);
            if ($label === "") $label = $user["LOGIN"];
        ?>
            <option value="<?=$user["ID"]?>"><?=$label?></option>
        <?php endwhile; ?>
    </select>

    <br><br>
    <button type="submit">Создать сайт</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    $("#create-site-users").select2({
        placeholder: "Выберите пользователей",
        allowClear: true,
        width: "resolve"
    });
});
</script>

<?php endif; ?>
