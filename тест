function openPagesDialog(siteId, siteName) {
  const html = `
    <div>
      <div style="margin-bottom:10px;">
        <button class="ui-btn ui-btn-primary ui-btn-xs" id="btnCreatePage">Создать страницу</button>
      </div>
      <div id="pagesBox"></div>
    </div>
  `;

  const mb = BX.UI.Dialogs.MessageBox.show({
    title: 'Страницы сайта: ' + BX.util.htmlspecialchars(siteName),
    message: html,
    buttons: BX.UI.Dialogs.MessageBoxButtons.CLOSE
  });

  // ВАЖНО: контент модалки появляется не мгновенно.
  // Поэтому вешаем обработчики после вставки в DOM.
  setTimeout(function () {
    const container = document.getElementById('pagesBox');
    if (!container) {
      BX.UI.Notification.Center.notify({ content: 'pagesBox не найден (модалка не вставилась)' });
      return;
    }

    loadPages(siteId, container);

    const btn = document.getElementById('btnCreatePage');
    if (!btn) {
      BX.UI.Notification.Center.notify({ content: 'btnCreatePage не найден' });
      return;
    }

    btn.addEventListener('click', function () {
      openCreatePageDialog(siteId, container);
    });
  }, 0);

  return mb;
}