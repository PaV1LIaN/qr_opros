$result = PH::createPortalSite($siteTitle, $siteCode, $roleName, $roleUsers);

$removeAck = ["create_site","created","warning","error","exists_code"];

if (!empty($result["success"])) {
    // Успех: удаляем старые служебные параметры и ставим новый created
    LocalRedirect($APPLICATION->GetCurPageParam("created=" . rawurlencode($siteTitle), $removeAck));
    die();
} elseif (($result["status"] ?? "") === "exists") {
    // Дубликат: warning (+ можно прокинуть exists_code для ссылки)
    $q = "warning=" . rawurlencode($result["message"]);
    if (!empty($result["code"])) {
        $q .= "&exists_code=" . rawurlencode((string)$result["code"]);
    }
    LocalRedirect($APPLICATION->GetCurPageParam($q, $removeAck));
    die();
} else {
    // Ошибка
    LocalRedirect($APPLICATION->GetCurPageParam("error=" . rawurlencode($result["message"]), $removeAck));
    die();
}




