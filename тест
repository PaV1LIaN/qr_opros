<?php
$mode    = $arResult['MODE'] ?? 'create';
$site    = $arResult['SITE'] ?? null;
$siteId  = (int)($arResult['SITE_ID'] ?? 0);

// значения по умолчанию для полей
$nameValue = $_POST['NAME'] ?? ($site['UF_NAME'] ?? '');
$codeValue = $_POST['CODE'] ?? ($site['UF_CODE'] ?? '');

// права: пока просто показываем как список ID
$viewersIds = $_POST['VIEWERS'][0] ?? (isset($arResult['VIEWERS']) ? implode(',', $arResult['VIEWERS']) : '');
$adminsIds  = $_POST['ADMINS'][0]  ?? (isset($arResult['ADMINS']) ? implode(',', $arResult['ADMINS'])  : '');
?>

<?php if (!empty($arResult['ERRORS'])): ?>
    <div style="color:red;">
        <?php foreach ($arResult['ERRORS'] as $error): ?>
            <div><?= htmlspecialcharsbx($error) ?></div>
        <?php endforeach; ?>
    </div>
<?php endif; ?>

<h2><?= $mode === 'edit' ? 'Редактирование сайта' : 'Создание сайта' ?></h2>

<form method="post">
    <?= bitrix_sessid_post() ?>
    <?php if ($mode === 'edit'): ?>
        <input type="hidden" name="SITE_ID" value="<?= $siteId ?>">
    <?php endif; ?>

    <div>
        <label>Название сайта:</label><br>
        <input type="text" name="NAME" value="<?= htmlspecialcharsbx($nameValue) ?>">
    </div>

    <div style="margin-top:5px;">
        <label>Код сайта (URL):</label><br>
        <input type="text" name="CODE" value="<?= htmlspecialcharsbx($codeValue) ?>">
        <small>Например: training-portal</small>
    </div>

    <div style="margin-top:5px;">
        <label>VIEWERS (ID пользователей, через запятую):</label><br>
        <input type="text" name="VIEWERS[]" value="<?= htmlspecialcharsbx($viewersIds) ?>" placeholder="Например: 1,2,3">
    </div>

    <div style="margin-top:5px;">
        <label>ADMINS (ID пользователей, через запятую):</label><br>
        <input type="text" name="ADMINS[]" value="<?= htmlspecialcharsbx($adminsIds) ?>" placeholder="Например: 1,4">
    </div>

    <div style="margin-top:10px;">
        <button type="submit">
            <?= $mode === 'edit' ? 'Сохранить изменения' : 'Создать сайт' ?>
        </button>
    </div>
</form>
