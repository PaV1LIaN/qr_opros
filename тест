<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/local/qr_opros/src/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Автомобили</title>
</head>

<script src="/local/qr_opros/jquery-3.6.0.min.js"></script>

<body>

<div class="container mt-4">

    <h2>Список автомобилей</h2>

    <div id="blocks-container" class="row mt-3"></div>

    <button id="addBlock" class="btn btn-success mt-3">Добавить автомобиль</button>

</div>


<!-- ==== МОДАЛКА ДОБАВЛЕНИЯ ==== -->
<div id="modal" class="modal-window" style="display:none;">
    <h3>Добавить автомобиль</h3>

    <label>Марка</label><br>
    <input type="text" id="nameCar"><br><br>

    <label>Тип</label><br>
    <input type="text" id="typeCar"><br><br>

    <label>Гос.номер</label><br>
    <input type="text" id="nomCar"><br><br>

    <button id="saveBlock" class="btn btn-primary">Сохранить</button>
    <button id="cancel" class="btn btn-secondary">Отмена</button>
</div>


<!-- ==== МОДАЛКА РЕДАКТИРОВАНИЯ ==== -->
<div id="editModal" class="modal-window" style="display:none;">
    <h3>Редактировать автомобиль</h3>

    <input type="hidden" id="editId">

    <label>Марка</label><br>
    <input type="text" id="editNameCar"><br><br>

    <label>Тип</label><br>
    <input type="text" id="editTypeCar"><br><br>

    <label>Гос.номер</label><br>
    <input type="text" id="editNomCar"><br><br>

    <button id="updateBlock" class="btn btn-primary">Сохранить изменения</button>
    <button id="editCancel" class="btn btn-secondary">Отмена</button>
</div>


<script>
$(document).ready(function() {

    // ==== загрузка карточек ====
    function loadBlocks() {
        $.ajax({
            url: 'load_block.php',
            method: 'GET',
            success: function(data) {
                $('#blocks-container').html(data);
            }
        });
    }

    loadBlocks();


    // ==== открыть модалку добавления ====
    $('#addBlock').click(function() {
        $('#modal').show();
        $(this).hide();
    });

    // ==== сохранить новую запись ====
    $('#saveBlock').click(function() {
        var nameCar = $('#nameCar').val();
        var typeCar = $('#typeCar').val();
        var nomCar  = $('#nomCar').val();

        $.ajax({
            url: 'add_block.php',
            method: 'POST',
            data: { nameCar: nameCar, typeCar: typeCar, nomCar: nomCar },
            success: function(blockData) {
                loadBlocks(); // грузим заново
                $('#modal').hide();
                $('#addBlock').show();

                $('#nameCar').val('');
                $('#typeCar').val('');
                $('#nomCar').val('');
            }
        });
    });

    $('#cancel').click(function() {
        $('#modal').hide();
        $('#addBlock').show();
    });


    // ==== КНОПКА ДЕАКТИВАЦИИ ====
    $(document).on('click', '.remove-btn', function() {
        const card = $(this).closest('[data-id]');
        const id   = card.data('id');

        $.ajax({
            url: 'remove_block.php',
            method: 'POST',
            data: { id: id },
            success: function() {
                loadBlocks();
            }
        });
    });


    // ==== ОТКРЫТЬ РЕДАКТИРОВАНИЕ ====
    $(document).on('click', '.edit-btn', function() {
        const card = $(this).closest('[data-id]');
        const id   = card.data('id');

        const name = card.find('.car-name').text().trim();
        const type = card.find('.car-type').text().trim();
        const nom  = card.find('.car-nom').text().trim();

        $('#editId').val(id);
        $('#editNameCar').val(name);
        $('#editTypeCar').val(type);
        $('#editNomCar').val(nom);

        $('#editModal').show();
    });

    $('#editCancel').click(function() {
        $('#editModal').hide();
    });


    // ==== СОХРАНЕНИЕ ИЗМЕНЕНИЙ ====
    $('#updateBlock').click(function() {
        const id      = $('#editId').val();
        const nameCar = $('#editNameCar').val();
        const typeCar = $('#editTypeCar').val();
        const nomCar  = $('#editNomCar').val();

        $.ajax({
            url: 'edit_block.php',
            method: 'POST',
            data: { id: id, nameCar: nameCar, typeCar: typeCar, nomCar: nomCar },
            success: function() {
                loadBlocks();
                $('#editModal').hide();
            }
        });
    });

});
</script>

</body>
</html>
